<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Details | Green Sprint</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <!-- Dashboard CSS -->
    <link rel="stylesheet" href="assets/css/dashboard.css">
    
    <style>
        .campaign-hero {
            position: relative;
            height: 350px;
            background-size: cover;
            background-position: center;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .campaign-hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 60%, rgba(0,0,0,0.2) 100%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 30px;
        }
        
        .campaign-status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 15px;
            width: fit-content;
        }
        
        .status-active {
            background: var(--primary-color);
            color: white;
        }
        
        .status-completed {
            background: var(--secondary-color);
            color: white;
        }
        
        .status-upcoming {
            background: var(--info-color);
            color: white;
        }
        
        .campaign-title {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .campaign-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            color: rgba(255,255,255,0.8);
        }
        
        .campaign-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-card {
            background: var(--card-background);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .info-card h3 {
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .progress-section {
            text-align: center;
            padding: 30px;
        }
        
        .progress-circle {
            width: 180px;
            height: 180px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .progress-circle svg {
            transform: rotate(-90deg);
            width: 180px;
            height: 180px;
        }
        
        .progress-circle-bg {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 12;
        }
        
        .progress-circle-fill {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .progress-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .progress-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--background-color);
            border-radius: 12px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .description-text {
            color: var(--text-secondary);
            line-height: 1.8;
        }
        
        .organizer-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: var(--background-color);
            border-radius: 12px;
        }
        
        .organizer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .organizer-info h4 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .organizer-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }
        
        .participants-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .participant-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: var(--background-color);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .participant-item:hover {
            background: rgba(76, 175, 80, 0.1);
        }
        
        .participant-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .participant-name {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .participant-trees {
            color: var(--primary-color);
            font-size: 0.8rem;
        }
        
        .trees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .tree-card {
            background: var(--background-color);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .tree-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .tree-card-image {
            height: 150px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .tree-card-content {
            padding: 15px;
        }
        
        .tree-card-title {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .tree-card-planter {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .impact-item {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%);
            border-radius: 12px;
        }
        
        .impact-icon {
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.3rem;
        }
        
        .impact-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .impact-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-join {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-join:hover {
            background: var(--primary-dark);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-share {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-share:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .timeline-dates {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background: var(--background-color);
            border-radius: 12px;
        }
        
        .timeline-date-item {
            text-align: center;
        }
        
        .timeline-date-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .timeline-date-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .location-info {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 20px;
            background: var(--background-color);
            border-radius: 12px;
        }
        
        .location-icon {
            width: 45px;
            height: 45px;
            background: var(--primary-color);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .location-details h5 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .location-details p {
            color: var(--text-secondary);
            margin: 0;
            font-size: 0.9rem;
        }
        
        .view-more-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-color);
            font-weight: 500;
            margin-top: 15px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .view-more-btn:hover {
            gap: 12px;
            color: var(--primary-dark);
        }
        
        @media (max-width: 768px) {
            .campaign-hero {
                height: 280px;
            }
            
            .campaign-title {
                font-size: 1.8rem;
            }
            
            .campaign-meta {
                flex-direction: column;
                gap: 10px;
            }
            
            .stats-grid,
            .impact-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .timeline-dates {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
        <i class="fa fa-bars"></i>
    </button>
    
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-logo">
                <img src="assets/images/green spirt (1).png" alt="Green Sprint">
                <h2>Green Sprint</h2>
            </div>
            
            <ul class="sidebar-nav">
                <li><a href="dashboard.html"><i class="fa fa-home"></i><span>Dashboard</span></a></li>
                <li><a href="tree-tracker.html"><i class="fa fa-qrcode"></i><span>Plant Tree</span></a></li>
                <li><a href="my-trees.html"><i class="fa fa-tree"></i><span>My Trees</span></a></li>
                <li><a href="campaigns.html" class="active"><i class="fa fa-bullhorn"></i><span>Campaigns</span></a></li>
                <li><a href="leaderboard.html"><i class="fa fa-trophy"></i><span>Leaderboard</span></a></li>
                <li><a href="analytics.html"><i class="fa fa-chart-line"></i><span>Analytics</span></a></li>
                <li><a href="community.html"><i class="fa fa-users"></i><span>Community</span></a></li>
                <li><a href="profile.html"><i class="fa fa-user"></i><span>Profile</span></a></li>
                <li><a href="#" onclick="logout()"><i class="fa fa-sign-out-alt"></i><span>Logout</span></a></li>
            </ul>
            
            <div class="sidebar-user">
                <img src="assets/images/default-avatar.png" alt="User" id="sidebar-avatar">
                <div class="sidebar-user-info">
                    <h4 id="sidebar-username">User</h4>
                    <span>Member</span>
                </div>
            </div>
        </aside>
        
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        
        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Back Link -->
            <div style="margin-bottom: 20px;">
                <a href="campaigns.html" style="color: var(--primary-color); text-decoration: none; font-weight: 500;">
                    <i class="fa fa-arrow-left"></i> All Campaigns
                </a>
            </div>
        
        <!-- Loading State -->
        <div class="loading-container" id="loading" style="text-align: center; padding: 50px;">
            <i class="fa fa-spinner fa-spin fa-3x" style="color: var(--primary-color);"></i>
            <p style="margin-top: 20px;">Loading campaign details...</p>
        </div>
        
        <!-- Campaign Content -->
        <div class="content-area" id="campaign-content" style="display: none;">
            <!-- Campaign Hero -->
            <div class="campaign-hero" id="campaign-hero">
                <div class="campaign-hero-overlay">
                    <span class="campaign-status-badge status-active" id="status-badge">
                        <i class="fas fa-circle me-2" style="font-size: 8px;"></i> Active
                    </span>
                    <h1 class="campaign-title" id="campaign-title">Mumbai Green Initiative</h1>
                    <div class="campaign-meta">
                        <span><i class="fas fa-calendar-alt"></i> <span id="campaign-dates">Jun 1 - Dec 31, 2024</span></span>
                        <span><i class="fas fa-users"></i> <span id="participant-count">45 participants</span></span>
                        <span><i class="fas fa-tree"></i> <span id="tree-count">127 trees planted</span></span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- Left Column -->
                <div class="col-lg-8">
                    <!-- Progress Card -->
                    <div class="info-card">
                        <h3><i class="fas fa-chart-pie text-success me-2"></i>Campaign Progress</h3>
                        <div class="progress-section">
                            <div class="progress-circle">
                                <svg viewBox="0 0 180 180">
                                    <circle class="progress-circle-bg" cx="90" cy="90" r="80"></circle>
                                    <circle class="progress-circle-fill" id="progress-fill" cx="90" cy="90" r="80" 
                                            stroke-dasharray="502.4" stroke-dashoffset="502.4"></circle>
                                </svg>
                                <div class="progress-text">
                                    <div class="progress-value" id="progress-value">25%</div>
                                    <div class="progress-label">Complete</div>
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="stat-planted">127</div>
                                    <div class="stat-label">Trees Planted</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="stat-target">500</div>
                                    <div class="stat-label">Target Trees</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="stat-remaining">373</div>
                                    <div class="stat-label">Remaining</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Environmental Impact -->
                    <div class="info-card">
                        <h3><i class="fas fa-globe text-success me-2"></i>Environmental Impact</h3>
                        <div class="impact-grid">
                            <div class="impact-item">
                                <div class="impact-icon">
                                    <i class="fas fa-cloud"></i>
                                </div>
                                <div class="impact-value" id="impact-co2">2,794</div>
                                <div class="impact-label">kg CO₂ Absorbed/Year</div>
                            </div>
                            <div class="impact-item">
                                <div class="impact-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="impact-value" id="impact-water">50,800</div>
                                <div class="impact-label">Liters Water Saved/Year</div>
                            </div>
                            <div class="impact-item">
                                <div class="impact-icon">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="impact-value" id="impact-oxygen">14,986</div>
                                <div class="impact-label">kg Oxygen Produced/Year</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div class="info-card">
                        <h3><i class="fas fa-info-circle text-success me-2"></i>About This Campaign</h3>
                        <p class="description-text" id="campaign-description">
                            Join us in our mission to make Mumbai greener! The Mumbai Green Initiative aims to plant 500 trees across various neighborhoods in Mumbai. This campaign focuses on native tree species that are well-suited to the local climate and provide maximum environmental benefits.
                            <br><br>
                            Our goal is to create green corridors that not only beautify the city but also help combat air pollution, reduce urban heat island effect, and provide habitat for local wildlife. Every tree planted makes a difference!
                        </p>
                    </div>
                    
                    <!-- Recent Trees -->
                    <div class="info-card">
                        <h3><i class="fas fa-seedling text-success me-2"></i>Recently Planted Trees</h3>
                        <div class="trees-grid" id="trees-grid">
                            <!-- Trees will be loaded here -->
                            <div class="tree-card">
                                <div class="tree-card-image" style="background-image: url('https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?w=400')">
                                </div>
                                <div class="tree-card-content">
                                    <div class="tree-card-title">Neem Tree</div>
                                    <div class="tree-card-planter">by John Doe • 2 days ago</div>
                                </div>
                            </div>
                            <div class="tree-card">
                                <div class="tree-card-image" style="background-image: url('https://images.unsplash.com/photo-1513836279014-a89f7a76ae86?w=400')">
                                </div>
                                <div class="tree-card-content">
                                    <div class="tree-card-title">Banyan Tree</div>
                                    <div class="tree-card-planter">by Jane Smith • 3 days ago</div>
                                </div>
                            </div>
                            <div class="tree-card">
                                <div class="tree-card-image" style="background-image: url('https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=400')">
                                </div>
                                <div class="tree-card-content">
                                    <div class="tree-card-title">Mango Tree</div>
                                    <div class="tree-card-planter">by Amit Kumar • 5 days ago</div>
                                </div>
                            </div>
                        </div>
                        <a href="#" class="view-more-btn" id="view-all-trees">
                            View All Trees <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    
                    <!-- Top Contributors -->
                    <div class="info-card">
                        <h3><i class="fas fa-trophy text-success me-2"></i>Top Contributors</h3>
                        <div class="participants-grid" id="top-contributors">
                            <div class="participant-item">
                                <img src="https://ui-avatars.com/api/?name=John+Doe&background=4CAF50&color=fff" alt="" class="participant-avatar">
                                <div>
                                    <div class="participant-name">John Doe</div>
                                    <div class="participant-trees">23 trees</div>
                                </div>
                            </div>
                            <div class="participant-item">
                                <img src="https://ui-avatars.com/api/?name=Jane+Smith&background=4CAF50&color=fff" alt="" class="participant-avatar">
                                <div>
                                    <div class="participant-name">Jane Smith</div>
                                    <div class="participant-trees">18 trees</div>
                                </div>
                            </div>
                            <div class="participant-item">
                                <img src="https://ui-avatars.com/api/?name=Amit+Kumar&background=4CAF50&color=fff" alt="" class="participant-avatar">
                                <div>
                                    <div class="participant-name">Amit Kumar</div>
                                    <div class="participant-trees">15 trees</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="col-lg-4">
                    <!-- Organizer -->
                    <div class="info-card">
                        <h3><i class="fas fa-user-shield text-success me-2"></i>Campaign Organizer</h3>
                        <div class="organizer-card">
                            <img src="https://ui-avatars.com/api/?name=Green+Sprint&background=4CAF50&color=fff" alt="Organizer" class="organizer-avatar" id="organizer-avatar">
                            <div class="organizer-info">
                                <h4 id="organizer-name">Green Sprint Team</h4>
                                <p id="organizer-role">Organization Admin</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timeline -->
                    <div class="info-card">
                        <h3><i class="fas fa-clock text-success me-2"></i>Campaign Timeline</h3>
                        <div class="timeline-dates">
                            <div class="timeline-date-item">
                                <div class="timeline-date-label">Start Date</div>
                                <div class="timeline-date-value" id="start-date">June 1, 2024</div>
                            </div>
                            <div class="timeline-date-item">
                                <i class="fas fa-arrow-right text-muted"></i>
                            </div>
                            <div class="timeline-date-item">
                                <div class="timeline-date-label">End Date</div>
                                <div class="timeline-date-value" id="end-date">December 31, 2024</div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <small class="text-muted" id="days-remaining">
                                <i class="fas fa-hourglass-half me-1"></i> 45 days remaining
                            </small>
                        </div>
                    </div>
                    
                    <!-- Location -->
                    <div class="info-card">
                        <h3><i class="fas fa-map-marker-alt text-success me-2"></i>Campaign Location</h3>
                        <div class="location-info">
                            <div class="location-icon">
                                <i class="fas fa-map-marked-alt"></i>
                            </div>
                            <div class="location-details">
                                <h5 id="location-name">Mumbai, Maharashtra</h5>
                                <p id="location-desc">Various neighborhoods across the city</p>
                            </div>
                        </div>
                        <div id="location-map" style="height: 200px; background: #e8f5e9; border-radius: 12px; margin-top: 15px; display: flex; align-items: center; justify-content: center;">
                            <span class="text-muted"><i class="fas fa-map"></i> Map View</span>
                        </div>
                    </div>
                    
                    <!-- All Participants -->
                    <div class="info-card">
                        <h3><i class="fas fa-users text-success me-2"></i>Participants (<span id="total-participants">45</span>)</h3>
                        <div class="participants-grid" id="all-participants">
                            <!-- Participants will be loaded here -->
                        </div>
                        <a href="#" class="view-more-btn" id="view-all-participants">
                            View All <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    
                    <!-- Tags -->
                    <div class="info-card">
                        <h3><i class="fas fa-tags text-success me-2"></i>Tags</h3>
                        <div class="d-flex flex-wrap gap-2" id="campaign-tags">
                            <span class="badge bg-success-subtle text-success">Urban Greening</span>
                            <span class="badge bg-success-subtle text-success">Native Species</span>
                            <span class="badge bg-success-subtle text-success">Community</span>
                            <span class="badge bg-success-subtle text-success">Climate Action</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-join" id="join-btn">
                    <i class="fas fa-hand-holding-seedling"></i> Join Campaign & Plant a Tree
                </button>
                <button class="btn-share" id="share-btn">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>
    </main>
    
    <!-- Scripts -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/supabase-client.js"></script>
    <script src="assets/js/auth.js"></script>
    
    <script>
        // Get campaign ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const campaignId = urlParams.get('id');
        
        let currentCampaign = null;
        let currentUser = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication
            const session = await AuthService.checkSession();
            if (!session) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = session.user;
            
            // Load campaign details
            await loadCampaignDetails();
            
            // Setup event handlers
            setupEventHandlers();
        });
        
        async function loadCampaignDetails() {
            try {
                if (!campaignId) {
                    throw new Error('No campaign ID provided');
                }
                
                const campaign = await GreenSprintDB.CampaignService.getById(campaignId);
                
                if (!campaign) {
                    throw new Error('Campaign not found');
                }
                
                currentCampaign = campaign;
                displayCampaignDetails(campaign);
                
                // Load participants
                await loadParticipants();
                
                // Load recent trees
                await loadRecentTrees();
                
            } catch (error) {
                console.error('Error loading campaign:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Campaign not found or unable to load details.
                        <br><br>
                        <a href="campaigns.html" class="btn btn-success">
                            <i class="fas fa-arrow-left"></i> Back to Campaigns
                        </a>
                    </div>
                `;
            }
        }
        
        function displayCampaignDetails(campaign) {
            // Hide loading, show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('campaign-content').style.display = 'block';
            
            // Set hero image
            const heroDiv = document.getElementById('campaign-hero');
            heroDiv.style.backgroundImage = `url(${campaign.cover_image || 'https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?w=1200'})`;
            
            // Set status badge
            const statusBadge = document.getElementById('status-badge');
            statusBadge.className = `campaign-status-badge status-${campaign.status}`;
            statusBadge.innerHTML = `<i class="fas fa-circle me-2" style="font-size: 8px;"></i> ${formatStatus(campaign.status)}`;
            
            // Set title and meta
            document.getElementById('campaign-title').textContent = campaign.name;
            document.getElementById('campaign-dates').textContent = 
                `${formatDate(campaign.start_date)} - ${formatDate(campaign.end_date)}`;
            document.getElementById('participant-count').textContent = 
                `${campaign.participant_count || 0} participants`;
            document.getElementById('tree-count').textContent = 
                `${campaign.current_trees || 0} trees planted`;
            
            // Set progress
            const progress = Math.round((campaign.current_trees / campaign.target_trees) * 100);
            document.getElementById('progress-value').textContent = `${progress}%`;
            
            const circumference = 2 * Math.PI * 80;
            const offset = circumference - (progress / 100) * circumference;
            document.getElementById('progress-fill').style.strokeDashoffset = offset;
            
            // Set stats
            document.getElementById('stat-planted').textContent = campaign.current_trees || 0;
            document.getElementById('stat-target').textContent = campaign.target_trees;
            document.getElementById('stat-remaining').textContent = 
                Math.max(0, campaign.target_trees - (campaign.current_trees || 0));
            
            // Set environmental impact
            const trees = campaign.current_trees || 0;
            document.getElementById('impact-co2').textContent = (trees * 22).toLocaleString();
            document.getElementById('impact-water').textContent = (trees * 400).toLocaleString();
            document.getElementById('impact-oxygen').textContent = (trees * 118).toLocaleString();
            
            // Set description
            document.getElementById('campaign-description').innerHTML = 
                campaign.description || 'No description available.';
            
            // Set organizer
            if (campaign.creator) {
                document.getElementById('organizer-avatar').src = 
                    campaign.creator.avatar_url || 
                    `https://ui-avatars.com/api/?name=${encodeURIComponent(campaign.creator.full_name)}&background=4CAF50&color=fff`;
                document.getElementById('organizer-name').textContent = 
                    campaign.creator.full_name || campaign.creator.username;
            }
            
            // Set dates
            document.getElementById('start-date').textContent = formatDate(campaign.start_date);
            document.getElementById('end-date').textContent = formatDate(campaign.end_date);
            
            // Calculate days remaining
            const endDate = new Date(campaign.end_date);
            const today = new Date();
            const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            
            if (daysRemaining > 0) {
                document.getElementById('days-remaining').innerHTML = 
                    `<i class="fas fa-hourglass-half me-1"></i> ${daysRemaining} days remaining`;
            } else {
                document.getElementById('days-remaining').innerHTML = 
                    `<i class="fas fa-check-circle me-1"></i> Campaign ended`;
            }
            
            // Set location
            if (campaign.location) {
                document.getElementById('location-name').textContent = campaign.location;
            }
            
            // Update join button
            updateJoinButton();
        }
        
        async function loadParticipants() {
            try {
                const participants = await GreenSprintDB.CampaignService.getParticipants(campaignId);
                
                document.getElementById('total-participants').textContent = participants.length;
                
                const participantsGrid = document.getElementById('all-participants');
                participantsGrid.innerHTML = participants.slice(0, 6).map(p => `
                    <div class="participant-item">
                        <img src="${p.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(p.full_name)}&background=4CAF50&color=fff`}" 
                             alt="${p.full_name}" class="participant-avatar">
                        <div>
                            <div class="participant-name">${p.full_name || p.username}</div>
                        </div>
                    </div>
                `).join('');
                
                // Top contributors
                const topContributors = document.getElementById('top-contributors');
                topContributors.innerHTML = participants.slice(0, 5).map(p => `
                    <div class="participant-item">
                        <img src="${p.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(p.full_name)}&background=4CAF50&color=fff`}" 
                             alt="${p.full_name}" class="participant-avatar">
                        <div>
                            <div class="participant-name">${p.full_name || p.username}</div>
                            <div class="participant-trees">${p.trees_in_campaign || 0} trees</div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading participants:', error);
            }
        }
        
        async function loadRecentTrees() {
            try {
                const trees = await GreenSprintDB.TreeService.getByCampaign(campaignId, 3);
                
                const treesGrid = document.getElementById('trees-grid');
                if (trees && trees.length > 0) {
                    treesGrid.innerHTML = trees.map(tree => `
                        <a href="tree-details.html?id=${tree.id}" class="tree-card text-decoration-none">
                            <div class="tree-card-image" style="background-image: url('${tree.photo_url || 'https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?w=400'}')">
                            </div>
                            <div class="tree-card-content">
                                <div class="tree-card-title">${tree.species?.common_name || 'Tree'}</div>
                                <div class="tree-card-planter">by ${tree.planter?.full_name || 'Unknown'} • ${timeAgo(tree.planting_date)}</div>
                            </div>
                        </a>
                    `).join('');
                }
                
            } catch (error) {
                console.error('Error loading trees:', error);
            }
        }
        
        function updateJoinButton() {
            const joinBtn = document.getElementById('join-btn');
            
            // Check if user is already a participant
            // For now, just show join button
            joinBtn.innerHTML = '<i class="fas fa-hand-holding-seedling"></i> Join Campaign & Plant a Tree';
        }
        
        function setupEventHandlers() {
            // Menu toggle
            document.getElementById('menu-toggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', async (e) => {
                e.preventDefault();
                await AuthService.logout();
                window.location.href = 'login.html';
            });
            
            // Join campaign
            document.getElementById('join-btn').addEventListener('click', async () => {
                if (!currentCampaign) return;
                
                try {
                    // Join campaign
                    await GreenSprintDB.CampaignService.join(campaignId);
                    
                    // Redirect to tree tracker with campaign pre-selected
                    window.location.href = `tree-tracker.html?campaign=${campaignId}`;
                    
                } catch (error) {
                    console.error('Error joining campaign:', error);
                    // Still redirect to tree tracker
                    window.location.href = `tree-tracker.html?campaign=${campaignId}`;
                }
            });
            
            // Share button
            document.getElementById('share-btn').addEventListener('click', () => {
                if (navigator.share) {
                    navigator.share({
                        title: currentCampaign?.name,
                        text: `Join the ${currentCampaign?.name} campaign on Green Sprint!`,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href);
                    alert('Link copied to clipboard!');
                }
            });
            
            // View all trees
            document.getElementById('view-all-trees').addEventListener('click', (e) => {
                e.preventDefault();
                // Could show a modal with all trees or redirect to filtered view
                alert('View all trees feature coming soon!');
            });
            
            // View all participants
            document.getElementById('view-all-participants').addEventListener('click', (e) => {
                e.preventDefault();
                alert('View all participants feature coming soon!');
            });
        }
        
        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
        }
        
        // Logout function
        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                await AuthService.logout();
                window.location.href = 'login.html';
            }
        }
        
        // Helper functions
        function formatStatus(status) {
            const statusMap = {
                'active': 'Active',
                'completed': 'Completed',
                'upcoming': 'Upcoming',
                'cancelled': 'Cancelled'
            };
            return statusMap[status] || status;
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'TBD';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        function timeAgo(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            const intervals = {
                year: 31536000,
                month: 2592000,
                week: 604800,
                day: 86400,
                hour: 3600,
                minute: 60
            };
            
            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval > 1 ? 's' : ''} ago`;
                }
            }
            
            return 'just now';
        }
    </script>
</body>
</html>
